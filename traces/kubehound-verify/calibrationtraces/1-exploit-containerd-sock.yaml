#https://elixir.bootlin.com/linux/v6.12.6/source/net/socket.c#L2095
apiVersion: cilium.io/v1alpha1
kind: TracingPolicy
metadata:
  name: detect-exploit-containerd-sock
spec:
  kprobes:
  - call: "sys_connect"
    syscall: true
    args:
    - index: 0
      type: "int"
    - index: 1
      type: "sock"
    - index: 2
      type: "int"
    returnArg:  
      index: 0
      type: "int"
    returnArgAction: "Post"
    selectors:
    - matchBinaries:
        - operator: "Postfix"
          values:
          - "crictl"

    #   matchBinaries: # Filter for crictl, though may use differnet tools
    #     - operator: "In"
    #       values:
    #       - "/usr/local/bin/crictl"
    # - matchActions:
    #   - action: Follow 
  # kprobes:
  # - call: "security_file_permission"
  #   syscall: false
  #   return: true
  #   args:
  #   - index: 0
  #     type: "file" # (struct file *) used for getting the path
  #   - index: 1
  #     type: "int" # 0x04 is MAY_READ, 0x02 is MAY_WRITE, 6 is MAY_READ | MAY_WRITE
  #   returnArg:  # Return: Return 0 if the hook is successful and permission is granted.
  #     index: 0
  #     type: "int"
  #   returnArgAction: "Post"
  #   selectors:
  #   - matchArgs:      
  #     - index: 0
  #       operator: "Postfix"
  #       values:
  #         - "containerd.sock" 
  #         - "dockershim.sock"
  #         - "crio.sock"
  #         - "cri-dockerd.sock"
  #     - index: 1
  #       operator: "Equal"
  #       values:
  #       - "4"
  #       - "6"
  #     matchNamespaces:
  #       - namespace: "Pid"
  #         operator: "NotIn"
  #         values:
  #         - "host_ns"
  #     matchBinaries:
  #       - operator: "Postfix"
  #         values:
  #         - "crictl"     



# {"process_kprobe":{"process":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6NjczNjMxMjU0NDk0NjoxMDQ4Nzc=", "pid":104877, "uid":0, "cwd":"/", "binary":"/usr/local/bin/crictl", "arguments":"--config /tmp/crictl.yaml ps -a", "flags":"execve rootcwd clone inInitTree", "start_time":"2025-01-07T12:19:15.386337884Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://7b5863d859b223b335b7eb7331792f7b7016174060587d6a2f1d3c1955c68cae", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:19:14Z", "pid":26}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, "docker":"7b5863d859b223b335b7eb7331792f7", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6NjczNjMxMjAyNzc5NDoxMDQ4NzY=", "refcnt":1, "tid":104882, "in_init_tree":true}, "parent":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6NjczNjMxMjAyNzc5NDoxMDQ4NzY=", "pid":104876, "uid":0, "cwd":"/", "binary":"/bin/sh", "arguments":"-c \"MOUNTED_SOCK_PATH=$(find /host/run -name dockershim.sock -o -name containerd.sock -o -name crio.sock -o -name cri-dockerd.sock 2>/dev/null | head -n 1)\nif [[ -z \"$MOUNTED_SOCK_PATH\" ]]; then\n echo \"No relevant sockets found. Exiting.\"\n exit 1\nfi\ncat <<EOF > /tmp/crictl.yaml\nruntime-endpoint: unix://$MOUNTED_SOCK_PATH\nimage-endpoint: unix://$MOUNTED_SOCK_PATH\ndebug: false\nEOF\ncc=\"/usr/local/bin/crictl --config /tmp/crictl.yaml\"\necho \"Listing all pods:\"\n$cc ps -a\nTARGET_POD_ID=$($cc ps -a | awk 'NR==2{print $1}')\n$cc exec -s $TARGET_POD_ID -- /bin/sh -c \"echo 'Hello from the target pod!'\"\nsleep infinity \n\"", "flags":"execve inInitTree", "start_time":"2025-01-07T12:19:15.385820739Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://7b5863d859b223b335b7eb7331792f7b7016174060587d6a2f1d3c1955c68cae", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:19:14Z", "pid":1}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, 
# "docker":"7b5863d859b223b335b7eb7331792f7", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6NjczNTYxMzc3OTcyNToxMDQ4Mjg=", "refcnt":1, "tid":104876, "in_init_tree":true}, "function_name":"__x64_sys_connect", 
# "args":[{"int_arg":6}, {"sock_arg":{"family":"26977", "type":"0", "protocol":"IPPROTO_IP", "saddr":"<nil>", "daddr":"<nil>", "sport":29806, "dport":25455, "cookie":"824637148048", "state":"110"}}, {"int_arg":39}], 
# "action":"KPROBE_ACTION_POST", "policy_name":"detect-exploit-containerd-sock", "return_action":"KPROBE_ACTION_POST"}, "node_name":"honeycluster-control-plane", "time":"2025-01-07T12:19:15.404442421Z"}

# {"process_kprobe":{"process":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6NjczNjMxMjU0NDk0NjoxMDQ4Nzc=", "pid":104877, "uid":0, "cwd":"/", "binary":"/usr/local/bin/crictl", "arguments":"--config /tmp/crictl.yaml ps -a", "flags":"execve rootcwd clone inInitTree", "start_time":"2025-01-07T12:19:15.386337884Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://7b5863d859b223b335b7eb7331792f7b7016174060587d6a2f1d3c1955c68cae", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:19:14Z", "pid":26}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, "docker":"7b5863d859b223b335b7eb7331792f7", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6NjczNjMxMjAyNzc5NDoxMDQ4NzY=", "refcnt":1, "tid":104880, "in_init_tree":true}, "parent":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6NjczNjMxMjAyNzc5NDoxMDQ4NzY=", "pid":104876, "uid":0, "cwd":"/", "binary":"/bin/sh", "arguments":"-c \"MOUNTED_SOCK_PATH=$(find /host/run -name dockershim.sock -o -name containerd.sock -o -name crio.sock -o -name cri-dockerd.sock 2>/dev/null | head -n 1)\nif [[ -z \"$MOUNTED_SOCK_PATH\" ]]; then\n echo \"No relevant sockets found. Exiting.\"\n exit 1\nfi\ncat <<EOF > /tmp/crictl.yaml\nruntime-endpoint: unix://$MOUNTED_SOCK_PATH\nimage-endpoint: unix://$MOUNTED_SOCK_PATH\ndebug: false\nEOF\ncc=\"/usr/local/bin/crictl --config /tmp/crictl.yaml\"\necho \"Listing all pods:\"\n$cc ps -a\nTARGET_POD_ID=$($cc ps -a | awk 'NR==2{print $1}')\n$cc exec -s $TARGET_POD_ID -- /bin/sh -c \"echo 'Hello from the target pod!'\"\nsleep infinity \n\"", "flags":"execve inInitTree", "start_time":"2025-01-07T12:19:15.385820739Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://7b5863d859b223b335b7eb7331792f7b7016174060587d6a2f1d3c1955c68cae", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:19:14Z", "pid":1}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, 
# "docker":"7b5863d859b223b335b7eb7331792f7", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6NjczNTYxMzc3OTcyNToxMDQ4Mjg=", "refcnt":1, "tid":104876, "in_init_tree":true}, "function_name":"__x64_sys_connect", 
# "args":[{"int_arg":3}, {"sock_arg":{"family":"26977", "type":"0", "protocol":"IPPROTO_IP", "priority":4, "saddr":"<nil>", "daddr":"<nil>", "sport":29806, "dport":25455, "cookie":"824637145360", "state":"110"}}, {"int_arg":39}],
#  "action":"KPROBE_ACTION_POST", "policy_name":"detect-exploit-containerd-sock", "return_action":"KPROBE_ACTION_POST"}, "node_name":"honeycluster-control-plane", "time":"2025-01-07T12:19:15.401883772Z"}
#{"process_kprobe":{"process":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzk4MzU3MzkwOToxMjU1OTE=", "pid":125591, "uid":0, "cwd":"/", "binary":"/usr/local/bin/crictl", "arguments":"--config /tmp/crictl.yaml ps -a", "flags":"execve rootcwd clone inInitTree", "start_time":"2025-01-07T12:43:43.041572869Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:43:42Z", "pid":14}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, "docker":"1e23ffff144e1ed2c80838955cb885f", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzM1MzAyMTk3MjoxMjU1NDI=", "refcnt":1, "tid":125598, "in_init_tree":true}, "parent":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzM1MzAyMTk3MjoxMjU1NDI=", "pid":125542, "uid":0, "cwd":"/", "binary":"/bin/sh", "arguments":"-c \"MOUNTED_SOCK_PATH=$(find /host/run -name dockershim.sock -o -name containerd.sock -o -name crio.sock -o -name cri-dockerd.sock 2>/dev/null | head -n 1)\nif [[ -z \"$MOUNTED_SOCK_PATH\" ]]; then\n echo \"No relevant sockets found. Exiting.\"\n exit 1\nfi\ncat <<EOF > /tmp/crictl.yaml\nruntime-endpoint: unix://$MOUNTED_SOCK_PATH\nimage-endpoint: unix://$MOUNTED_SOCK_PATH\ndebug: false\nEOF\ncc=\"/usr/local/bin/crictl --config /tmp/crictl.yaml\"\necho \"Listing all pods:\"\n$cc ps -a\nTARGET_POD_ID=$($cc ps -a | awk 'NR==2{print $1}')\n$cc exec -s $TARGET_POD_ID -- /bin/sh -c \"echo 'Hello from the target pod!'\"\nsleep infinity \n\"", "flags":"execve rootcwd clone inInitTree", "start_time":"2025-01-07T12:43:42.411021405Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:43:42Z", "pid":1}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, "docker":"1e23ffff144e1ed2c80838955cb885f", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzA5NzIxMzAyMDoxMjU0ODg=", "tid":125542, "in_init_tree":true}, "function_name":"__x64_sys_connect", "args":[{"int_arg":3}, {"sock_arg":{"family":"26977", "type":"0", "protocol":"IPPROTO_IP", "saddr":"<nil>", "daddr":"<nil>", "sport":29806, "dport":25455, "cookie":"824640152208", "state":"110"}}, {"int_arg":39}], "action":"KPROBE_ACTION_POST", "policy_name":"detect-exploit-containerd-sock", "return_action":"KPROBE_ACTION_POST"}, "node_name":"honeycluster-control-plane", "time":"2025-01-07T12:43:43.052970439Z"}
#{"process_kprobe":{"process":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzk4MzU3MzkwOToxMjU1OTE=", "pid":125591, "uid":0, "cwd":"/", "binary":"/usr/local/bin/crictl", "arguments":"--config /tmp/crictl.yaml ps -a", "flags":"execve rootcwd clone inInitTree", "start_time":"2025-01-07T12:43:43.041572869Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:43:42Z", "pid":14}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, "docker":"1e23ffff144e1ed2c80838955cb885f", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzM1MzAyMTk3MjoxMjU1NDI=", "refcnt":1, "tid":125595, "in_init_tree":true}, "parent":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzM1MzAyMTk3MjoxMjU1NDI=", "pid":125542, "uid":0, "cwd":"/", "binary":"/bin/sh", "arguments":"-c \"MOUNTED_SOCK_PATH=$(find /host/run -name dockershim.sock -o -name containerd.sock -o -name crio.sock -o -name cri-dockerd.sock 2>/dev/null | head -n 1)\nif [[ -z \"$MOUNTED_SOCK_PATH\" ]]; then\n echo \"No relevant sockets found. Exiting.\"\n exit 1\nfi\ncat <<EOF > /tmp/crictl.yaml\nruntime-endpoint: unix://$MOUNTED_SOCK_PATH\nimage-endpoint: unix://$MOUNTED_SOCK_PATH\ndebug: false\nEOF\ncc=\"/usr/local/bin/crictl --config /tmp/crictl.yaml\"\necho \"Listing all pods:\"\n$cc ps -a\nTARGET_POD_ID=$($cc ps -a | awk 'NR==2{print $1}')\n$cc exec -s $TARGET_POD_ID -- /bin/sh -c \"echo 'Hello from the target pod!'\"\nsleep infinity \n\"", "flags":"execve rootcwd clone inInitTree", "start_time":"2025-01-07T12:43:42.411021405Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:43:42Z", "pid":1}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, "docker":"1e23ffff144e1ed2c80838955cb885f", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzA5NzIxMzAyMDoxMjU0ODg=", "tid":125542, "in_init_tree":true}, "function_name":"__x64_sys_connect", "args":[{"int_arg":6}, {"sock_arg":{"family":"26977", "type":"0", "protocol":"IPPROTO_IP", "saddr":"<nil>", "daddr":"<nil>", "sport":29806, "dport":25455, "cookie":"824640152848", "state":"110"}}, {"int_arg":39}], "action":"KPROBE_ACTION_POST", "policy_name":"detect-exploit-containerd-sock", "return_action":"KPROBE_ACTION_POST"}, "node_name":"honeycluster-control-plane", "time":"2025-01-07T12:43:43.056172559Z"}

#  runc generates noise: here we can use the state:99 to filter out #todo check if the states 99 vs 110 mean something deeper
# These ones done change the number of the first value and the second occurence has the "mark" field set 
#  "{"process_kprobe":{"process":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzMwMzUwOTQ5ODoxMjU1NDg=", "pid":125548, "uid":0, "cwd":"/run/containerd/io.containerd.runtime.v2.task/k8s.io/1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736/rootfs", "binary":"/kind/bin/mount-product-files.sh", "arguments":"/kind/bin/mount-product-files.sh", "flags":"execve clone inInitTree", "start_time":"2025-01-07T12:43:42.361508694Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:43:42Z", "pid":7}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, "docker":"1e23ffff144e1ed2c80838955cb885f", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzI5MjQ4NzQyMToxMjU1NDI=", "tid":125548, "in_init_tree":true}, "parent":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzI5MjQ4NzQyMToxMjU1NDI=", "pid":125542, "uid":0, "cwd":"/run/containerd/io.containerd.runtime.v2.task/k8s.io/686d8c7a7633ab736a77c24dfe3092ea9e895ca86a2949909a7fa66b08ea122f", "binary":"/usr/local/sbin/runc", "arguments":"--root /run/containerd/runc/k8s.io --log /run/containerd/io.containerd.runtime.v2.task/k8s.io/1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736/log.json --log-format json --systemd-cgroup create --bundle /run/containerd/io.containerd.runtime.v2.task/k8s.io/1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736 --pid-file /run/containerd/io.containerd.runtime.v2.task/k8s.io/1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736/init.pid 1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736", "flags":"execve", "start_time":"2025-01-07T12:43:42.350486555Z", "auid":4294967295, "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzI1MDM3NjI3MDoxMjU1MzI=", "refcnt":1, "tid":125542, "in_init_tree":false}, "function_name":"__x64_sys_connect", "args":[{"int_arg":6}, {"sock_arg":{"family":"28531", "type":"0", "protocol":"IPPROTO_IP", "saddr":"<nil>", "daddr":"<nil>", "sport":12132, "dport":29539, "cookie":"140726497346400", "state":"99"}}, {"int_arg":110}], "action":"KPROBE_ACTION_POST", "policy_name":"detect-exploit-containerd-sock", "return_action":"KPROBE_ACTION_POST"}, "node_name":"honeycluster-control-plane", "time":"2025-01-07T12:43:42.362485738Z"}
# {"process_kprobe":{"process":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzMwMzUwOTQ5ODoxMjU1NDg=", "pid":125548, "uid":0, "cwd":"/run/containerd/io.containerd.runtime.v2.task/k8s.io/1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736/rootfs", "binary":"/kind/bin/mount-product-files.sh", "arguments":"/kind/bin/mount-product-files.sh", "flags":"execve clone inInitTree", "start_time":"2025-01-07T12:43:42.361508694Z", "auid":4294967295, "pod":{"namespace":"default", "name":"kh-exploit-containerd-sock", "container":{"id":"containerd://1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736", "name":"attacker-container", "image":{"id":"docker.io/entlein/exploit-containerd-sock@sha256:8571374aab5e80ba9f55fdca946157296d36ce31c7d396319a6d06e0ad9e1f57", "name":"docker.io/entlein/exploit-containerd-sock:0.0.1"}, "start_time":"2025-01-07T12:43:42Z", "pid":7}, "pod_labels":{"app":"kubehound-edge-test"}, "workload":"kh-exploit-containerd-sock", "workload_kind":"Pod"}, "docker":"1e23ffff144e1ed2c80838955cb885f", "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzI5MjQ4NzQyMToxMjU1NDI=", "tid":125548, "in_init_tree":true}, "parent":{"exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzI5MjQ4NzQyMToxMjU1NDI=", "pid":125542, "uid":0, "cwd":"/run/containerd/io.containerd.runtime.v2.task/k8s.io/686d8c7a7633ab736a77c24dfe3092ea9e895ca86a2949909a7fa66b08ea122f", "binary":"/usr/local/sbin/runc", "arguments":"--root /run/containerd/runc/k8s.io --log /run/containerd/io.containerd.runtime.v2.task/k8s.io/1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736/log.json --log-format json --systemd-cgroup create --bundle /run/containerd/io.containerd.runtime.v2.task/k8s.io/1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736 --pid-file /run/containerd/io.containerd.runtime.v2.task/k8s.io/1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736/init.pid 1e23ffff144e1ed2c80838955cb885f74d239eb59a4ffec9fea07a56211ac736", "flags":"execve", "start_time":"2025-01-07T12:43:42.350486555Z", "auid":4294967295, "parent_exec_id":"aG9uZXljbHVzdGVyLWNvbnRyb2wtcGxhbmU6ODIwMzI1MDM3NjI3MDoxMjU1MzI=", "refcnt":1, "tid":125542, "in_init_tree":false}, "function_name":"__x64_sys_connect", "args":[{"int_arg":6}, {"sock_arg":{"family":"28531", "type":"0", "protocol":"IPPROTO_IP", "mark":32646, "priority":4104436224, "saddr":"<nil>", "daddr":"<nil>", "sport":12132, "dport":29539, "cookie":"140726497346896", "state":"99"}}, {"int_arg":110}], "action":"KPROBE_ACTION_POST", "policy_name":"detect-exploit-containerd-sock", "return_action":"KPROBE_ACTION_POST"}, "node_name":"honeycluster-control-plane", "time":"2025-01-07T12:43:42.362557995Z"}
